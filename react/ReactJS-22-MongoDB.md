# ReactJS-22 mongooseë¥¼ ì´ìš©í•œ MongoDB ì—°ë™



## ğŸ”¥1. MongoDB

- ì„œë²„ë¥¼ ê°œë°œí•  ë•Œ ë°ì´í„°ë² ì´ìŠ¤ë¥¼ ì‚¬ìš©í•˜ë©´ ì›¹ ì„œë¹„ìŠ¤ì—ì„œ ì‚¬ìš©ë˜ëŠ” ë°ì´í„°ë¥¼ ì €ì¥í•˜ê³ , íš¨ìœ¨ì ìœ¼ë¡œ ì¡°íšŒí•˜ê±°ë‚˜ ìˆ˜ì •í•  ìˆ˜ ìˆë‹¤.
- ê¸°ì¡´ì—ëŠ” MySQL, OracleDB, PostgreSQL ê°™ì€ RDBMS(ê´€ê³„í˜• ë°ì´í„°ë² ì´ìŠ¤)ë¥¼ ìì£¼ ì‚¬ìš©í–ˆë‹¤.
- ê·¸ëŸ¬ë‚˜ ê´€ê³„í˜• ë°ì´í„°ë² ì´ìŠ¤ì˜ í•œê³„ê°€ ì¡´ì¬í•œë‹¤.
  1. ë°ì´í„° ìŠ¤í‚¤ë§ˆê°€ ê³ ì •ì ì´ë‹¤.
     - ìŠ¤í‚¤ë§ˆ: ë°ì´í„°ë² ì´ìŠ¤ì— ì–´ë–¤ í˜•ì‹ì˜ ë°ì´í„°ë¥¼ ë„£ì„ì§€ì— ëŒ€í•œ ì •ë³´ë¥¼ ê°€ë¦¬í‚¨ë‹¤.
     - ìƒˆë¡œ ë“±ë¡í•˜ëŠ” ë°ì´í„° í˜•ì‹ì´ ê¸°ì¡´ì— ìˆë˜ ë°ì´í„°ë“¤ê³¼ ë‹¤ë¥´ë©´, ê¸°ì¡´ ë°ì´í„°ë¥¼ ëª¨ë‘ ìˆ˜ì •í•´ì•¼ ìƒˆ ë°ì´í„°ë¥¼ ë“±ë¡í•  ìˆ˜ ìˆë‹¤.
     - ë°ì´í„° ì–‘ì´ ë§ì„ ë•ŒëŠ” ë°ì´í„°ë² ì´ìŠ¤ì˜ ìŠ¤í‚¤ë§ˆë¥¼ ë³€ê²½í•˜ëŠ” ì‘ì—…ì´ ë§¤ìš° ë²ˆê±°ë¡­ë‹¤.
  2. í™•ì¥ì„±
     - RDMSëŠ” ì €ì¥í•˜ê³  ì²˜ë¦¬í•´ì•¼ í•  ë°ì´í„°ì–‘ì´ ëŠ˜ì–´ë‚˜ë©´ ì—¬ëŸ¬ ì»´í“¨í„°ì— ë¶„ì‚°ì‹œí‚¤ëŠ” ê²ƒì´ ì•„ë‹ˆë¼, í•´ë‹¹ ë°ì´í„°ë² ì´ìŠ¤ ì„œë²„ì˜ ì„±ëŠ¥ì„ ì—…ê·¸ë ˆì´ë“œí•˜ëŠ” ë°©ì‹ìœ¼ë¡œ í™•ì¥í•´ ì£¼ì–´ì•¼ í•œë‹¤.
- MongoDBëŠ” ì´ëŸ¬í•œ í•œê³„ë¥¼ ê·¹ë³µí•œ ë¬¸ì„œ ì§€í–¥ì  NoSQL ë°ì´í„°ë² ì´ìŠ¤ì´ë‹¤.
  - ë°ì´í„°ë² ì´ìŠ¤ì— ë“±ë¡í•˜ëŠ” ë°ì´í„°ë“¤ì€ ìœ ë™ì ì¸ ìŠ¤í‚¤ë§ˆë¥¼ ì§€ë‹ ìˆ˜ ìˆë‹¤.
  - ì—¬ëŸ¬ ì»´í“¨í„°ë¡œ ë¶„ì‚°í•˜ì—¬ ì²˜ë¦¬í•  ìˆ˜ ìˆë„ë¡ í™•ì¥í•˜ê¸° ì‰½ê²Œ ì„¤ê³„ë˜ì–´ ìˆë‹¤.
- ìƒí™©ë³„ë¡œ ì í•©í•œ ë°ì´í„°ë² ì´ìŠ¤ë¥¼ ì„ íƒí•˜ëŠ” ê²ƒì´ ì¤‘ìš”í•˜ë‹¤.
  - ë°ì´í„°ì˜ êµ¬ì¡°ê°€ ìì£¼ ë°”ë€ë‹¤ë©´ MongoDBê°€ ìœ ë¦¬í•˜ë‹¤.
  - ê¹Œë‹¤ë¡œìš´ ì¡°ê±´ìœ¼ë¡œ ë°ì´í„°ë¥¼ í•„í„°ë§í•´ì•¼ í•˜ê±°ë‚˜, ACID íŠ¹ì„±ì„ ì§€ì¼œì•¼ í•œë‹¤ë©´ RDBMSê°€ ìœ ë¦¬í•˜ë‹¤.
  - (ACID íŠ¹ì„±ì€ ì›ìì„±(Atomicity), ì¼ê´€ì„±(Consistency), ê³ ë¦½ì„±(Isolation), ì§€ì†ì„±(Durability)ì˜ ì• ê¸€ìë¥¼ ë– ì„œ ë§Œë“  ìš©ì–´ì´ê³ , ë°ì´í„°ë² ì´ìŠ¤ íŠ¸ëœì­ì…˜ì´ ì•ˆì „í•˜ê²Œ ì²˜ë¦¬ë˜ëŠ” ê²ƒì„ ë³´ì¥í•˜ê¸° ìœ„í•œ ì„±ì§ˆì„ ì˜ë¯¸í•œë‹¤.)

### 1-1) ë¬¸ì„œ

- ì—¬ê¸°ì„œ ë§í•˜ëŠ” 'ë¬¸ì„œ(document)'ëŠ” RDBMSì˜ ë ˆì½”ë“œ(record)ì™€ ê°œë…ì´ ë¹„ìŠ·í•˜ë‹¤.

- ë¬¸ì„œì˜ ë°ì´í„° êµ¬ì¡°ëŠ” í•œ ê°œ ì´ìƒì˜ í‚¤-ê°’ ìŒìœ¼ë¡œ ë˜ì–´ ìˆë‹¤.

  - ```json
    // ë¬¸ì„œ ì˜ˆì‹œ
    {
      "_id": ObejctId("5023951200ab23400fe034"),
      "username": "chichi",
      "name": { first: "C.H.", last: "Choi" }
    }
    ```

- ë¬¸ì„œëŠ” BSON(ë°”ì´ë„ˆë¦¬ í˜•íƒœì˜ JSON) í˜•íƒœë¡œ ì €ì¥ëœë‹¤. ê·¸ë ‡ê¸° ë•Œë¬¸ì— ë‚˜ì¤‘ì— JSON í˜•íƒœì˜ ê°ì²´ë¥¼ ë°ì´í„°ë² ì´ìŠ¤ì— ì €ì¥í•  ë•Œ, í° ê³µìˆ˜ë¥¼ ë“¤ì´ì§€ ì•Šê³  ë°ì´í„°ë² ì´ìŠ¤ì— ë“±ë¡í•  ìˆ˜ ìˆë‹¤.

- ìƒˆë¡œìš´ ë¬¸ì„œë¥¼ ë§Œë“¤ë©´ _idë¼ëŠ” ê³ ìœ ê°’ì„ ìë™ìœ¼ë¡œ ìƒì„±í•˜ëŠ”ë°, ì´ ê°’ì€ ì‹œê°„, ë¨¸ì‹  ì•„ì´ë””, í”„ë¡œì„¸ìŠ¤ ì•„ì´ë””, ìˆœì°¨ ë²ˆí˜¸ë¡œ ë˜ì–´ ìˆì–´ ê°’ì˜ ê³ ìœ í•¨ì„ ë³´ì¥í•œë‹¤.

- ì—¬ëŸ¬ ë¬¸ì„œê°€ ë“¤ì–´ìˆëŠ” ê³³ì„ ì»¬ë ‰ì…˜ ì´ë¼ê³  í•œë‹¤.

  - ê¸°ì¡´ RDBMSì—ì„œëŠ” í…Œì´ë¸” ê°œë…ì„ ì‚¬ìš©í•˜ë¯€ë¡œ ê° í…Œì´ë¸”ë§ˆë‹¤ ê°™ì€ ìŠ¤í‚¤ë§ˆë¥¼ ê°€ì§€ê³  ìˆì–´ì•¼ í•œë‹¤.

  - ìƒˆë¡œ ë“±ë¡í•´ì•¼ í•  ë°ì´í„°ê°€ ë‹¤ë¥¸ ìŠ¤í‚¤ë§ˆë¥¼ ê°€ì§€ê³  ìˆë‹¤ë©´, ê¸°ì¡´ ë°ì´í„°ë“¤ì˜ ìŠ¤í‚¤ë§ˆë„ ëª¨ë‘ ë°”ê¾¸ì–´ ì£¼ì–´ì•¼ í•œë‹¤.

  - ë°˜ë©´ MongoDBëŠ” ë‹¤ë¥¸ ìŠ¤í‚¤ë§ˆë¥¼ ê°€ì§€ê³  ìˆëŠ” ë¬¸ì„œë“¤ì´ í•œ ì»¬ë ‰ì…˜ì—ì„œ ê³µì¡´í•  ìˆ˜ ìˆë‹¤.

    - ```json
      {
        "_id": ObejctId("5023951200ab23400fe034"),
        "username": "chichi",
        "name": { first: "C.H.", last: "Choi" }
      },
      {
        "_id": ObejctId("5023951200ab23400fe035"),
        "username": "chichi2",
        "phone": "010-1234-1234"
      }
      ```



### 1-2) MongoDB êµ¬ì¡°

- ì„œë²„ í•˜ë‚˜ì— ë°ì´í„°ë² ì´ìŠ¤ë¥¼ ì—¬ëŸ¬ ê°œ ê°€ì§€ê³  ìˆì„ ìˆ˜ ìˆë‹¤.
- ê° ë°ì´í„°ë² ì´ìŠ¤ì—ëŠ” ì—¬ëŸ¬ ê°œì˜ ì»¬ë ‰ì…˜ì´ ìˆë‹¤.
- ì»¬ë ‰ì…˜ ë‚´ë¶€ì—ëŠ” ë¬¸ì„œë“¤ì´ ìˆë‹¤.

![reactjs-22-01](md-images/reactjs-22-01.png)



### 1-3) ìŠ¤í‚¤ë§ˆ ë””ìì¸

- MongoDBì—ì„œ ìŠ¤í‚¤ë§ˆë¥¼ ë””ìì¸í•˜ëŠ” ë°©ì‹ì€ ê¸°ì¡´ RDBMSì—ì„œ ìŠ¤í‚¤ë§ˆë¥¼ ë””ìì¸í•˜ëŠ” ë°©ì‹ê³¼ ì™„ì „íˆ ë‹¤ë¥´ë‹¤.
- ê¸°ì¡´ì˜ RDBMSë¡œ ë””ìì¸í•œë‹¤ë©´ ë‹¤ìŒê³¼ ê°™ë‹¤.

![reactjs-22-02](md-images/reactjs-22-02.png)

- NoSQLì—ì„œëŠ” ê·¸ëƒ¥ ëª¨ë“  ê²ƒì„ ë¬¸ì„œ í•˜ë‚˜ì— ë„£ëŠ”ë‹¤.

```json
{
  id: ObjectId,
  title: String,
	body: String,
  username: String,
  createdDate: Date,
  comments: [
    {
      _id: ObejctId,
      text: String,
      createdDate: Date
    }
  ]
}
```



## ğŸ”¥2. MongoDB ì„œë²„ ì¤€ë¹„

### 2-1) ì„¤ì¹˜

```bash
$ brew tap mongodb/brew
$ brew install mongodb-community@4.2
$ brew services start mongodb-community@4.2
```

### 2-2) MongoDB ì‘ë™ í™•ì¸

```bash
$ mongo
MongoDB shell version v4.2.15
connecting to: mongodb://127.0.0.1:27017/?compressors=disabled&gssapiServiceName=mongodb
Implicit session: session { "id" : UUID("beaccfbd-b0b9-496a-b3a6-e9d0705adb33") }
MongoDB server version: 4.2.15
...
```

- `Mongo Not Found` ê°€ í‘œì‹œë  ê²½ìš° mongoê°€ ì„¤ì¹˜ëœ pathë¥¼ ì°¸ì¡°í•  ìˆ˜ ìˆê²Œ ì„¤ì •í•´ì¤€ë‹¤.([ì°¸ê³ ](https://stackoverflow.com/questions/22862808/mongod-command-not-found-os-x))

```bash
> version()
4.2.15
```



## ğŸ”¥3. mongooseì˜ ì„¤ì¹˜ ë° ì ìš©

- mongooseëŠ” Node.js í™˜ê²½ì—ì„œ ì‚¬ìš©í•˜ëŠ” MongoDB ê¸°ë°˜ ODM(Object Data Modelling) ë¼ì´ë¸ŒëŸ¬ì´ë‹¤.
- ë°ì´í„°ë² ì´ìŠ¤ ë¬¸ì„œë“¤ì„ ìë°”ìŠ¤í¬ë¦½íŠ¸ ê°ì²´ì²˜ëŸ¼ ì‚¬ìš©í•  ìˆ˜ ìˆê²Œ í•´ì¤€ë‹¤.
- ë°±ì—”í”„ í”„ë¡œì íŠ¸ì— ì´ì–´ì„œ ì§„í–‰í•¨ìœ¼ë¡œ í”„ë¡œì íŠ¸ ë””ë ‰í„°ë¦¬ì—ì„œ ë‹¤ìŒ ëª…ë ¹ì–´ë¥¼ ì…ë ¥í•œë‹¤.

```bash
$ yarn add mongoose dotenv
```

- dotenvëŠ” í™˜ê²½ë³€ìˆ˜ë“¤ì„ íŒŒì¼ì— ë„£ê³  ì‚¬ìš©í•  ìˆ˜ ìˆê²Œ í•˜ëŠ” ê°œë°œë„êµ¬ì´ë‹¤.

- mongooseë¥¼ ì‚¬ìš©í•˜ì—¬ MongoDBì— ì ‘ì†í•  ë•Œ, ì„œë²„ì— ì£¼ì†Œë‚˜ ê³„ì • ë° ë¹„ë°€ë²ˆí˜¸ê°€ í•„ìš”í•˜ë‹¤. ì´ë ‡ê²Œ ë¯¼ê°í•˜ê³  í™˜ê²½ë³„ë¡œ ë‹¬ë¼ì§ˆ ìˆ˜ ìˆëŠ” ê°’ì€ ì½”ë“œ ì•ˆì— ì‘ì„±í•˜ì§€ ì•Šê³ , í™˜ê²½ë³€ìˆ˜ë¡œ ì„¤ì •í•˜ëŠ” ê²ƒì´ ì¢‹ë‹¤.

  

### 3-1) .env í™˜ê²½ë³€ìˆ˜ íŒŒì¼ ìƒì„±

- í”„ë¡œì íŠ¸ ë£¨íŠ¸ ê²½ë¡œì— .env íŒŒì¼ì„ ë§Œë“ ë‹¤.

```text
# .env
PORT=4000
MONGO_URI=mongodb://localhost:27017/blog
```

- ì—¬ê¸°ì„œ blogëŠ” ìš°ë¦¬ê°€ ì‚¬ìš©í•  ë°ì´í„°ë² ì´ìŠ¤ ì´ë¦„ì´ë‹¤. ì§€ì •í•œ ë°ì´í„°ë² ì´ìŠ¤ê°€ ì„œë²„ì— ì—†ë‹¤ë©´ ìë™ìœ¼ë¡œ ë§Œë“¤ì–´ì¤€ë‹¤.

```javascript
// src/index.js
require('dotenv').config();
(...)

// ë¹„êµ¬ì¡°í™” í• ë‹¹ì„ í†µí•´ process.env ë‚´ë¶€ ê°’ì— ëŒ€í•œ ë ˆí¼ëŸ°ìŠ¤ ë§Œë“¤ê¸°
const { PORT } = process.env;

(...)

// PORTê°€ ì§€ì •ë˜ì–´ ìˆì§€ ì•Šë‹¤ë©´ 4000ì„ ì‚¬ìš©
const port = PORT || 4000;
app.listen(port, () => {
  console.log('Listening to port %d', port);
});
```

- .env íŒŒì¼ì—ì„œ PORTë¥¼ 4001ë¡œ ë³€ê²½í•œ ë’¤ ì„œë²„ë¥¼ ì¬ì‹œì‘í•˜ë©´ ë°”ë€ í¬íŠ¸ë¡œ ì‹¤í–‰ëœ ê²ƒì„ ë³¼ ìˆ˜ ìˆë‹¤.

![reactjs-22-03](md-images/reactjs-22-03.png)



### 3-2) mongooseë¡œ ì„œë²„ì™€ ë°ì´í„°ë² ì´ìŠ¤ ì—°ê²°

```javascript
(...)
const mongoose = require('mongoose');

// ë¹„êµ¬ì¡°í™” í• ë‹¹ì„ í†µí•´ process.env ë‚´ë¶€ ê°’ì— ëŒ€í•œ ë ˆí¼ëŸ°ìŠ¤ ë§Œë“¤ê¸°
const { PORT, MONGO_URI } = process.env;

mongoose
  .connect(MONGO_URI, { useNewUrlParser: true, useFindAndModify: false })
  .then(() => {
    console.log('Connected to MongoDB');
  })
  .catch((e) => {
    console.error(e);
  });

(...)
```



## 4. esmìœ¼ë¡œ ES ëª¨ë“ˆ import/export ë¬¸ë²• ì‚¬ìš©

- ë¦¬ì•¡íŠ¸ í”„ë¡œì íŠ¸ì—ì„œ ì‚¬ìš©í•´ ì˜¤ë˜ ES ëª¨ë“ˆ import/export ë¬¸ë²•ì€ Node.jsì—ì„œ ì•„ì§ ì •ì‹ ì§€ì›ë˜ì§€ ì•ŠëŠ”ë‹¤.
- ê¹”ë”í•œ ì½”ë“œë¥¼ ìœ„í•´ ì‚¬ìš©í•  ìˆ˜ ìˆë„ë¡ ì„¤ì •í•œë‹¤.

```bash
$ yarn add esm
```

- ê¸°ì¡´ src/index.js íŒŒì¼ì˜ ì´ë¦„ì„ main.jsë¡œ ë³€ê²½í•˜ê³ , index.js íŒŒì¼ì„ ìƒˆë¡œ ìƒì„±í•´ì„œ ë‹¤ìŒê³¼ ê°™ì´ ì‘ì„±í•œë‹¤.

```javascript
// src/index.js
// ì´ íŒŒì¼ì—ì„œë§Œ no-global-assign ESLint ì˜µì…˜ì„ ë¹„í™œì„±í™”í•œë‹¤.
/* eslint-disable no-global-assign */

require = require('esm')(module /*, options*/);
module.exports = require('./main.js');
```

- package.json íŒŒì¼ì—ì„œ ìŠ¤í¬ë¦½íŠ¸ë„ ìˆ˜ì •í•´ì¤€ë‹¤.

```json
// package.json
{
  ...,
  "scripts": {
    "start": "node -r esm src",
    "start:dev": "nodemon --watch src/ -r esm src/index.js"
  }
}
```

- ESLintì—ì„œ import/export êµ¬ë¬¸ì„ ì‚¬ìš©í•´ë„ ì˜¤ë¥˜ë¡œ ê°„ì£¼í•˜ì§€ ì•Šë„ë¡ ë‹¤ìŒê³¼ ê°™ì´ .eslintrc.json ì„ ìˆ˜ì •í•œë‹¤.

```json
// .eslintrc.json
{
  ...,
  "parserOptions": {
    "ecmaVersion": 12,
    "sourceType": "module"
  },
  ...,
}
```

- ê·¸ë¦¬ê³  í˜„ì¬ê¹Œì§€ ì‘ì„±í•œ ì½”ë“œ íŒŒì¼ë“¤ì„ import/export êµ¬ë¬¸ìœ¼ë¡œ ìˆ˜ì •í•œë‹¤.

